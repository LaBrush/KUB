<?php

namespace Kub\RessourceBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * RessourceRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class RessourceRepository extends EntityRepository
{

	public function findByAll($search)
	{
		$qb = $this->_em->createQuery(
			"SELECT r, m, n
			 FROM KubRessourceBundle:Ressource r
			 LEFT JOIN r.matiere m
			 LEFT JOIN r.niveau n

			 WHERE 
			 	(r.titre LIKE :search) OR
			 	(r.description LIKE :search) OR
			 	(m.name LIKE :search) OR
			 	(n.name LIKE :search)
			"
		);

		$qb->setParameter('search', '%' . $search . '%');
		

		return $qb->getArrayResult();
	}

}
